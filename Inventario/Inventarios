CLEAROUTPUT


/* RUTINAS */
NEWCMD getCantidadPedidos pedidos
	POISSON 1 7 pedidos
END

NEWCMD laborarDia cantidadUnidadesInventarioI hayPedido diasEntrega cantidadPorOrdenar _hayPedido _diasEntrega _cantidadPedidos _cantidadUnidadesInventarioF
	
	/* Generar Peidios */
	getCantidadPedidos pedidos
	_cantidadPedidos = pedidos

	/* Asignacion de variables */
	_cantidadUnidadesInventarioI = cantidadUnidadesInventarioI
	_cantidadUnidadesInventarioF = cantidadUnidadesInventarioI
	_hayPedido = hayPedido

	/* Revisar si se necesita hacer re-fill */
	IF diasEntrega > 1 
		_diasEntrega = diasEntrega - 1 
	ELSE
		IF diasEntrega = 1
			 _diasEntrega = diasEntrega - 1 
			 _cantidadUnidadesInventarioF = _cantidadUnidadesInventarioF + cantidadPorOrdenar
			 _hayPedido = 0
		ELSE
			_diasEntrega = diasEntrega
		END
	END
	
	/* Substraer los pedidos entegados del dia */
	_cantidadUnidadesInventarioF = _cantidadUnidadesInventarioF - _cantidadPedidos
END

NEWCMD generarDiasEntrega resultado
	UNIFORM 1 0 1 random
	resultado = 0
	IF random <= 0.3 
		resultado = 1
	END
	IF 0.3 < random AND random <= 0.7
		resultado = 2
	END
	IF 0.7 <= random
		resultado = 3
	END
END


NEWCMD simularLabor corridas cantidadUnidadesInventarioIniciales cantidadPorOrdenar puntoDeReorden No ini q t x fin
	
	/* Estados Iniciales */
	hayPedido = 0
	diasEntrega = 0
	cantidadPedidos = 0
	corridasSimulacion = 0
	pedirEntrega = 0
	cantidadFinalDelDia = cantidadUnidadesInventarioIniciales
	cantidadInicioDelDia = cantidadUnidadesInventarioIniciales
	
	/* Mostrar Resultados */
	No = ()
	ini = ()
	q = ()
	T = ()
	x = ()
	fin = ()

	/* Inicio de Simulacion */
	WHILE corridasSimulacion < corridas 

		cantidadInicioDelDia = cantidadFinalDelDia
		
		laborarDia cantidadInicioDelDia hayPedido diasEntrega cantidadPorOrdenar _hayPedido _diasEntrega _cantidadPedidos _cantidadUnidadesInventarioF
		
		/* Actualizar datos de dia laborado */
		cantidadFinalDelDia = _cantidadUnidadesInventarioF 
		hayPedido = _hayPedido
		diasEntrega = _diasEntrega
		cantidadPedidos = _cantidadPedidos

		/* Pedir Unidades */
		IF pedirEntrega = 1
			pedirEntrega = 0
			generarDiasEntrega resultadoDias
			diasEntrega = resultadoDias
			hayPedido = 1
		END

		/* Pedir Unidades */
		IF hayPedido = 0 AND cantidadFinalDelDia <= puntoDeReorden AND pedirEntrega = 0
			pedirEntrega = 1
		END

		CONCAT No corridasSimulacion No
		CONCAT ini cantidadInicioDelDia ini
		CONCAT q hayPedido q
		CONCAT t diasEntrega t
		CONCAT x cantidadPedidos x
		CONCAT fin cantidadFinalDelDia fin

		corridasSimulacion = corridasSimulacion + 1
	END
END 


NEWCMD calcularCostos precioOrden precioInv precioPen q fin _costoFijo _costoInv _costoPen _costoTotal
	SUM q _costoFijo
	_costoFijo = precioOrden * _costoFijo
	
	_costoInv = 0
	_costoPen = 0
	
	FOREACH cantidad fin
		IF cantidad < 0
			ABS cantidad cantidad
			_costoPen = _costoPen + cantidad
		ELSE
			_costoInv = _costoInv + cantidad
		END  
	END
	_costoPen = _costoPen * precioPen
	_costoInv = _costoInv * precioInv
	_costoTotal = _costoPen + _costoInv + _costoFijo
END

NEWCMD simularInventarios corridas cantidadUnidadesInventarioIniciales precioOrden preioInv precioPen
	NEWARRAY resultados 10 10
	COPY 1,10 cantidadPorOrdenar
	FOREACH contQ cantidadPorOrdenar
		COPY 1,cantidadPorOrdenar puntoReorden
		FOREACH contR puntoReorden
			qReal = contQ * 10
			rReal = contR * 10
			simularLabor 365 cantidadUnidadesInventarioIniciales qReal rReal No ini q t x fin
			calcularCostos 100 20 50 q fin costoFijo costoInv costoPen costoTotal
			resultados[contQ][contR] = costoTotal
		END
	END
	OUTPUT "q\\r     "
	OUTPUT "%11.7F\t%11.7F\t%11.7F\t%11.7F\t%11.7F\t%11.7F\t%11.7F\t%11.7F\t%11.7F\t%11.7F\n" 10 20 30 40 50 60 70 80 90 100
	FOREACH row 10,1
		realQ = row * 10
		OUTPUT "%5.3F\t" realQ
		FOREACH column 1,row
			print column
			OUTPUT "%11.7F\t\n" resultados[row][column]
		END
	END
END




/* PROGRAMA PRINCIPAL */
'simularLabor 10 50 50 20 No ini q t x fin
'calcularCostos 100 20 50 q fin costoFijo costoInv costoPen costoTotal
'print TABLE No%8.0F ini%8.0F q%8.0F t%8.0F x%8.0F fin%8.0F
/*
total = 0
REPEAT 10000
	simularLabor 365 50 50 20 No ini q t x fin
	calcularCostos 100 20 50 q fin costoFijo costoInv costoPen costoTotal
	total = total + costoTotal
END
x = total / 10000
print x
*/

'print costoFijo
'print costoInv
'print costoPen
'print costoTotal
simularInventarios 365 50 100 20 50 



